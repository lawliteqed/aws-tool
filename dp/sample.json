{
  "objects": [
    {
      "period": "1 Hour",
      "startDateTime": "2017-09-29T06:00:00",
      "name": "every 1 hour",
      "id": "DefaultSchedule",
      "type": "Schedule"
    },
    {
      "directoryPath": "#{myS3OutputLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}",
      "onFail": {
        "ref": "ActionId_XqwMJ"
      },
      "name": "test-sakai-S3OutputLocation",
      "id": "S3OutputLocation",
      "type": "S3DataNode"
    },
    {
      "subnetId": "subnet-406cde37",
      "imageId": "ami-383dfa5e",
      "onFail": {
        "ref": "ActionId_XqwMJ"
      },
      "securityGroupIds": [
        "sg-14ab6170"
      ],
      "instanceType": "t2.small",
      "name": "test-sakai-EC2ResourceObj",
      "id": "EC2ResourceObj",
      "type": "Ec2Resource",
      "terminateAfter": "10 Minutes"
    },
    {
      "onFail": {
        "ref": "ActionId_XqwMJ"
      },
      "directoryPath": "#{myS3InputLoc}",
      "name": "test-sakai-S3InputLocation",
      "id": "S3InputLocation",
      "type": "S3DataNode"
    },
    {
      "role": "dp-test-sakai-role",
      "subject": "[FAIL] #{node.name}",
      "name": "OnFailAction",
      "id": "ActionId_XqwMJ",
      "message": "name: #{node.name}\ntype: #{node.type}\nstatus: #{node.@status}\nscheduledStartTime: #{node.@scheduledStartTime}\nscheduledEndTime: #{node.@scheduledEndTime}\nactualStartTime: #{node.@actualStartTime}\nactualEndTime: #{node.@actualEndTime}\nerrorId: #{node.errorId}\nerrorMessage: #{node.errorMessage}\nerrorStackTrace: #{node.errorStackTrace}",
      "type": "SnsAlarm",
      "topicArn": "arn:aws:sns:ap-northeast-1:869806778421:sakai"
    },
    {
      "failureAndRerunMode": "CASCADE",
      "schedule": {
        "ref": "DefaultSchedule"
      },
      "resourceRole": "dp-test-sakai-prf",
      "pipelineLogUri": "s3://test-sakai-s3/",
      "role": "dp-test-sakai-role",
      "scheduleType": "CRON",
      "name": "Default",
      "id": "Default"
    },
    {
      "output": {
        "ref": "S3OutputLocation"
      },
      "input": {
        "ref": "S3InputLocation"
      },
      "stage": "true",
      "onFail": {
        "ref": "ActionId_XqwMJ"
      },
      "name": "test-sakai-ShellCommandActivityObj",
      "id": "ShellCommandActivityObj",
      "runsOn": {
        "ref": "EC2ResourceObj"
      },
      "type": "ShellCommandActivity",
      "command": "#{myShellCmd}"
    }
  ],
  "parameters": [
    {
      "description": "S3 output folder",
      "id": "myS3OutputLoc",
      "type": "AWS::S3::ObjectKey"
    },
    {
      "description": "S3 input folder",
      "id": "myS3InputLoc",
      "type": "AWS::S3::ObjectKey"
    },
    {
      "default": "dummy",
      "description": "Shell command to run",
      "id": "myShellCmd",
      "type": "String"
    }
  ],
  "values": {
    "myShellCmd": "dummy",
    "myS3InputLoc": "s3://test-sakai-s3/",
    "myS3OutputLoc": "s3://test-sakai-s3/log"
  }
}
