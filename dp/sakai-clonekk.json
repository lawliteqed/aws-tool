{
    "objects": [
        {
            "id": "S3InputLocation",
            "name": "S3InputLocation",
            "directoryPath": "#{myS3InputLoc}",
            "type": "S3DataNode"
        },
        {
            "id": "ShellCommandActivityObj",
            "name": "ShellCommandActivityObj",
            "output": {
                "ref": "S3OutputLocation"
            },
            "input": {
                "ref": "S3InputLocation"
            },
            "stage": "true",
            "runsOn": {
                "ref": "EC2ResourceObj"
            },
            "type": "ShellCommandActivity",
            "command": "#{myShellCmd}"
        },
        {
            "id": "EC2ResourceObj",
            "name": "EC2ResourceObj",
            "imageId": "ami-f5786892",
            "securityGroupIds": "sg-71158f14",
            "instanceType": "t2.medium",
            "keyPair": "odashima",
            "type": "Ec2Resource",
            "terminateAfter": "20 Minutes"
        },
        {
            "id": "Default",
            "name": "Default",
            "failureAndRerunMode": "CASCADE",
            "resourceRole": "DataPipelineDefaultResourceRole",
            "pipelineLogUri": "s3://pipeline-test-odashima",
            "role": "DataPipelineDefaultRole",
            "scheduleType": "ONDEMAND"
        },
        {
            "id": "S3OutputLocation",
            "name": "S3OutputLocation",
            "directoryPath": "#{myS3OutputLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}",
            "type": "S3DataNode"
        }
    ],
    "parameters": [
        {
            "id": "myS3OutputLoc",
            "description": "S3 output folder",
            "type": "AWS::S3::ObjectKey"
        },
        {
            "id": "myS3InputLoc",
            "default": "s3://us-east-1.elasticmapreduce.samples/pig-apache-logs/data",
            "description": "S3 input folder",
            "type": "AWS::S3::ObjectKey"
        },
        {
            "id": "myShellCmd",
            "default": "grep -rc \"GET\" ${INPUT1_STAGING_DIR}/* > ${OUTPUT1_STAGING_DIR}/output.txt",
            "description": "Shell command to run",
            "type": "String"
        }
    ],
    "values": {
        "myShellCmd": "export INPUT1_STAGING_DIR\nexport OUTPUT1_STAGING_DIR\nsudo yum install strace -y\nsudo freshclam\nsudo clamdscan ${INPUT1_STAGING_DIR}/\n:\nsleep 300",
        "myS3InputLoc": "s3://pipeline-test-odashima",
        "myS3OutputLoc": "s3://pipeline-test-odashima"
    }
}
