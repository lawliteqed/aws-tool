{
    "parameters": [
        {
            "type": "AWS::S3::ObjectKey", 
            "id": "myS3OutputLoc", 
            "description": "S3 output folder"
        }, 
        {
            "default": "s3://us-east-1.elasticmapreduce.samples/pig-apache-logs/data", 
            "type": "AWS::S3::ObjectKey", 
            "id": "myS3InputLoc", 
            "description": "S3 input folder"
        }, 
        {
            "default": "grep -rc \"GET\" ${INPUT1_STAGING_DIR}/* > ${OUTPUT1_STAGING_DIR}/output.txt", 
            "type": "String", 
            "id": "myShellCmd", 
            "description": "Shell command to run"
        }
    ], 
    "objects": [
        {
            "directoryPath": "#{myS3InputLoc}", 
            "type": "S3DataNode", 
            "id": "S3InputLocation", 
            "name": "S3InputLocation"
        }, 
        {
            "name": "ShellCommandActivityObj", 
            "command": "#{myShellCmd}", 
            "input": {
                "ref": "S3InputLocation"
            }, 
            "output": {
                "ref": "S3OutputLocation"
            }, 
            "stage": "true", 
            "type": "ShellCommandActivity", 
            "id": "ShellCommandActivityObj", 
            "runsOn": {
                "ref": "EC2ResourceObj"
            }
        }, 
        {
            "terminateAfter": "20 Minutes", 
            "name": "EC2ResourceObj", 
            "securityGroupIds": "sg-71158f14", 
            "keyPair": "odashima", 
            "id": "EC2ResourceObj", 
            "imageId": "ami-f5786892", 
            "type": "Ec2Resource", 
            "instanceType": "t2.medium"
        }, 
        {
            "pipelineLogUri": "s3://pipeline-test-odashima", 
            "name": "Default", 
            "failureAndRerunMode": "CASCADE", 
            "resourceRole": "DataPipelineDefaultResourceRole", 
            "role": "DataPipelineDefaultRole", 
            "scheduleType": "ONDEMAND", 
            "id": "Default"
        }, 
        {
            "directoryPath": "#{myS3OutputLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}", 
            "type": "S3DataNode", 
            "id": "S3OutputLocation", 
            "name": "S3OutputLocation"
        }
    ], 
    "values": {
        "myS3InputLoc": "s3://pipeline-test-odashima", 
        "myS3OutputLoc": "s3://pipeline-test-odashima", 
        "myShellCmd": "export INPUT1_STAGING_DIR\nexport OUTPUT1_STAGING_DIR\nsudo yum install strace -y\nsudo freshclam\nsudo clamdscan ${INPUT1_STAGING_DIR}/\n:\nsleep 300"
    }
}
